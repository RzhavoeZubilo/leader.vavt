<?php
/**
 * User: densh
 * Date: 28.02.2022
 * Time: 14:27
 */

global $CFG;

require_once($CFG->libdir . '/formslib.php');

class news_item extends \moodleform
{
    const EDITOR_OPTIONS = [
        'changeformat' => 1,
        'noclean'      => 0,
        'trusttext'    => 0,

        'subdirs' => 0,
        'maxfiles' => EDITOR_UNLIMITED_FILES,
        'accepted_types' => ['.jpg', '.jpeg', '.png']
    ];

    function definition()
    {
        global $DB, $USER;

        $editoroptions = self::EDITOR_OPTIONS;

        $mform = &$this->_form;
        $mform->addElement('hidden', 'itemid', 0);
        $mform->setType('itemid', PARAM_INT);
        $mform->addElement('hidden', 'action', 0);
        $mform->setType('action', PARAM_INT);
        $mform->addElement('hidden', 'usermodified', $USER->id);
        $mform->setType('usermodified', PARAM_INT);
        $mform->addElement('hidden', 'timemodified', time());
        $mform->setType('timemodified', PARAM_INT);

        $mform->addElement('text', 'name', "Заголовок");
        $mform->setType('name', PARAM_TEXT);

        $mform->addElement(
            'filemanager',
            'picture',
            "Картинка",
            null,
            [
                'subdirs' => 0,
                'maxfiles' => 1,
                'accepted_types' => ['.jpg', '.jpeg', '.png']
            ]
        );

        $mform->addElement('editor', 'paragraph', 'Текст новости', null, $editoroptions);

        $this->add_action_buttons();
    }
    function validation($data, $files)
    {
        $errors = parent::validation($data, $files); // TODO: Change the autogenerated stub
        return $errors;
    }

}
